<!doctype html><html lang=pt>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>How to set up a simple Wireguard VPN - .blog</title><meta name=description content="Install Wireguard I&rsquo;m using a Debian virtual machine for the server. In Debian 10, you&rsquo;ll need to install the following two packages:
apt install wireguard-dkms wireguard-tools
Set up keys First, navigate to /etc/wireguard (If not created, run mkdir /etc/wireguard as root) and then run the following commands as root:
wg genkey | tee laptop-private.key | wg pubkey > laptop-public.key wg genkey | tee server-private.key | wg pubkey > server-public.key
The first line is for the public and private keys of the client, named laptop because, well, it&rsquo;ll be used on a laptop.">
<meta name=author content>
<meta name=keywords content="arch,debian,howto,tips,vpn,wireguard">
<link rel=canonical href=https://blog.brunomiguel.net/post/how-to-set-up-a-simple-wireguard-vpn/>
<script data-goatcounter=https://blog-brunomiguel.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel="preload stylesheet" as=style href=https://blog.brunomiguel.net/app.min.css>
<link rel="preload stylesheet" as=style href=https://blog.brunomiguel.net/an-old-hope.min.css>
<script defer src=https://blog.brunomiguel.net/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://blog.brunomiguel.net/theme.png>
<link rel=preload as=image href=https://blog.brunomiguel.net/twitter.svg>
<link rel=preload as=image href=https://blog.brunomiguel.net/github.svg>
<link rel=icon href=https://blog.brunomiguel.net/favicon.ico>
<link rel=apple-touch-icon href=https://blog.brunomiguel.net/apple-touch-icon.png>
<meta name=generator content="Hugo 0.93.2">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.brunomiguel.net">
<meta name=twitter:title content="How to set up a simple Wireguard VPN">
<meta name=twitter:description content="Install Wireguard I&rsquo;m using a Debian virtual machine for the server. In Debian 10, you&rsquo;ll need to install the following two packages:
apt install wireguard-dkms wireguard-tools
Set up keys First, navigate to /etc/wireguard (If not created, run mkdir /etc/wireguard as root) and then run the following commands as root:
wg genkey | tee laptop-private.key | wg pubkey > laptop-public.key wg genkey | tee server-private.key | wg pubkey > server-public.key
The first line is for the public and private keys of the client, named laptop because, well, it&rsquo;ll be used on a laptop.">
<meta property="og:title" content="How to set up a simple Wireguard VPN">
<meta property="og:type" content="article">
<meta property="og:image" content="https://blog.brunomiguel.net">
<meta property="og:url" content="https://blog.brunomiguel.net/post/how-to-set-up-a-simple-wireguard-vpn/">
<meta property="og:description" content="Install Wireguard I&rsquo;m using a Debian virtual machine for the server. In Debian 10, you&rsquo;ll need to install the following two packages:
apt install wireguard-dkms wireguard-tools
Set up keys First, navigate to /etc/wireguard (If not created, run mkdir /etc/wireguard as root) and then run the following commands as root:
wg genkey | tee laptop-private.key | wg pubkey > laptop-public.key wg genkey | tee server-private.key | wg pubkey > server-public.key
The first line is for the public and private keys of the client, named laptop because, well, it&rsquo;ll be used on a laptop.">
<meta property="og:locale" content="pt">
<meta property="og:site_name" content=".blog">
<meta property="article:published_time" content="2020-02-15T00:00:00+00:00">
<meta property="article:modified_time" content="2020-02-15T00:00:00+00:00">
<script>window.onload=function(){window.matchMedia("(prefers-color-scheme: dark)").matches&&!localStorage.getItem("prefers-color-scheme-dark")&&localStorage.setItem("prefers-color-scheme-dark",!0)}</script>
</head><body class=not-ready data-menu=true>
<header class=header>
<p class=logo>
<a class=site-name href=https://blog.brunomiguel.net>.blog</a>
</p><nav class=menu>
<a href=/about/>Sobre</a>
<a href=https://github.com/brunomiguel/antinonio/>Lista Antinónio</a>
<a href=https://userrepository.eu/>Userrepository</a>
<a href=https://www.icrc.org/en/where-we-work/europe-central-asia/ukraine>Apoia a Ucrânia</a>
</nav><nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/brunomiguel target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/brunomiguel target=_blank></a>
<a class=rss style=--url:url(./rss.svg) href=https://blog.brunomiguel.net/index.xml target=_blank></a>
</nav><a class=btn-dark></a>
<script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script>
</header><main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>15/02/2020</time>
<span>Bruno Miguel</span>
<span>Tempo de leitura: 3 minutos
</span>
</p><h1>How to set up a simple Wireguard VPN</h1></header><section class=post-content><p><img src=images/network-1572617_1920.jpg alt></p><h2 id=install-wireguardhttpswwwwireguardcomquickstart>Install <a href=https://www.wireguard.com/quickstart/>Wireguard</a></h2><p>I&rsquo;m using a Debian virtual machine for the server. In Debian 10, you&rsquo;ll need to install the following two packages:</p><p>apt install wireguard-dkms wireguard-tools</p><h2 id=set-up-keys>Set up keys</h2><p>First, navigate to <code>/etc/wireguard</code> (If not created, run <code>mkdir /etc/wireguard</code> as root) and then run the following commands as root:</p><p>wg genkey | tee laptop-private.key | wg pubkey > laptop-public.key
wg genkey | tee server-private.key | wg pubkey > server-public.key</p><p>The first line is for the public and private keys of the client, named laptop because, well, it&rsquo;ll be used on a laptop. But you can choose any other name.</p><h2 id=configure-the-wireguard-server>Configure the Wireguard server</h2><p>First, enable IP forwarding. Since we&rsquo;re only using IPv4, edit the <code>/etc/sysctl.conf</code> file as root, locate the <code>net.ipv4.ip_forward</code> line, uncomment it and change the value to 1.</p><p>Now, you need to create the <code>/etc/wireguard/wg0.conf</code>. This will be both the name of the connection interface and the configuration file for that interface. I&rsquo;m using just one for a simple setup.</p><p>[Interface]
Address = 10.200.200.1/24
ListenPort = 51820
PrivateKey = <copy private key from server-private.key>
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE</p><p>[Peer]</p><h1 id=laptop>laptop</h1><p>PublicKey = <copy public key from laptop-public.key>
AllowedIPs = 10.200.200.2/32</p><p>Now you are ready to start the Wireguard daemon, so it can accept connections. Just run:</p><p>wg-quick up wg0</p><h3 id=some-things-to-know>Some things to know</h3><h4 id=interface>[Interface]</h4><p><strong>Address:</strong> the private IPv4 addresses (you can also use IPv6 addresses) for the Wireguard server subnet. In this example, clients connection to the server will be assigned IPs ranging from 10.200.200.1 to 10.200.200.254.</p><p><strong>ListenPort</strong>: the port where Wireguard will listen. Don&rsquo;t forget to open it in your firewall.</p><p><strong>PrivateKey</strong>: the content from server-private.key.</p><p><strong>PostUp and PostDown</strong>: defines steps to be run after the interface is turned on or off, respectively. In this case, iptables is used to set IP masquerade rules to allow all the clients to share the server’s IPv4 address. The rules will then be cleared once the tunnel is down. Don&rsquo;t forget to change <code>eth0</code> to your server&rsquo;s network device.</p><h4 id=peer>[Peer]</h4><p><strong>PublicKey</strong>: the content from laptop-public.key.</p><p><strong>AllowedIPs</strong>: the subnet IP assigned to that client when it connects to the server</p><h2 id=set-up-the-client>Set up the client</h2><p>On the client side, you&rsquo;ll also have to install Wireguard. If you&rsquo;re using Debian, Ubuntu or any distribution based on the previous two, the command will be the same (I&rsquo;m assuming Ubuntu uses the same package names. If not, change it to your needs). In Arch, the distribution I&rsquo;m currently using, you can install packages with:</p><p>pacman -Syuv wireguard-dkms wireguard-tools</p><h3 id=configure-the-wireguard-client>Configure the Wireguard client</h3><p>Create the <code>/etc/wireguard/wg0.conf</code> file and populate it with the following content:</p><p>[Interface]
Address = 10.200.200.2/24
PrivateKey = <copy private key from laptop-private.key></p><p>[Peer]
PublicKey = <copy public key from server-public.key>
AllowedIPs = 0.0.0.0/0
Endpoint = xxx.xxx.xxx.xxx:51820
PersistentKeepalive = 25</p><h3 id=some-things-to-know-1>Some things to know</h3><h4 id=interface-1>[Interface]</h4><p><strong>Addresss</strong>: the client&rsquo;s IP address in Wiregard&rsquo;s subnet.</p><p><strong>PrivateKey</strong>: the content from laptop-private.key.</p><h4 id=peer-1>[Peer]</h4><p><strong>PublicKey</strong>: the content from server-public.key.</p><p><strong>AllowedIPs</strong>: set it to 0.0.0.0/0 to forward all IPv4 traffic through Wireguard.</p><p><strong>Endpoint</strong>: the server IP address, followed by the port to connect to.</p><p><strong>PersistentKeepalive</strong>: the number of seconds you wish the client sends a keepalive packet to the server. This is useful if the client is behind NAT or a firewall</p><h2 id=test-the-connection>Test the connection</h2><p>On the client side, run <code>wg-quick up wg0</code>. You should now have a working Wireguard connection just like any VPN.</p><p>If you found a typo or an error, please use the comment box to report it. Also, if you found the post useful, please share it on social media, so it can reach a larger audience.</p></section><footer class=post-tags>
<small><strong>categorias</strong><br>
<a href=https://blog.brunomiguel.net/categories/geekices>geekices</a>
</small>
<br><br>
<small><strong>tags</strong><br>
<a href=https://blog.brunomiguel.net/tags/arch>arch</a>
<a href=https://blog.brunomiguel.net/tags/debian>debian</a>
<a href=https://blog.brunomiguel.net/tags/howto>howto</a>
<a href=https://blog.brunomiguel.net/tags/tips>tips</a>
<a href=https://blog.brunomiguel.net/tags/vpn>vpn</a>
<a href=https://blog.brunomiguel.net/tags/wireguard>wireguard</a>
</small>
</footer><div id=disqus_thread class=post-comments></div><script>var disqusShortname="blog-brunomiguel",script=document.createElement("script");script.src="https://"+disqusShortname+".disqus.com/embed.js",script.setAttribute("data-timestamp",+new Date),document.head.appendChild(script)</script>
<nav class=post-nav>
<a class=prev href=https://blog.brunomiguel.net/post/covid19-e-a-desinformacao-manual-de-sobrevivencia/><span>←</span><span>#COVID19 e a …</span></a>
<a class=next href=https://blog.brunomiguel.net/post/lxqt/><span>LXQT</span><span>→</span></a>
</nav></article></main><footer class=footer>
<p>Licença: <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC-BY-SA-4.0</a></p><p>Baseado em <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️ and <a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper</a></p><p>Alojado pela <a href=https://webtuga.pt rel=noopener target=_blank>Webtuga</a></p></footer></body></html>